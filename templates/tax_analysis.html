{% extends "base.html" %}

{% block title %}MyStockTax - Tax ë¶„ì„{% endblock %}

{% block extra_css %}
<style>
    /* ì›ë³¸ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    .tax-page-container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
    }

    .tax-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .tax-header h1 {
        font-size: 2em;
        margin-bottom: 10px;
    }

    .tax-content {
        padding: 30px;
    }

    .tax-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .tax-card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
    }

    .tax-card:hover {
        border-color: #667eea;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .tax-card.active {
        border-color: #667eea;
        background: #f0f4ff;
    }

    .tax-card-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        cursor: pointer;
        user-select: none;
    }

    .tax-card-header input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-right: 10px;
        cursor: pointer;
    }

    .tax-card-title {
        font-size: 1.2em;
        font-weight: bold;
        color: #333;
    }

    .tax-info {
        font-size: 0.9em;
        color: #666;
        margin-bottom: 10px;
        line-height: 1.5;
    }

    .tax-input-group {
        margin-top: 15px;
        display: none;
    }

    .tax-card.active .tax-input-group {
        display: block;
    }

    .tax-input-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.9em;
        color: #555;
        font-weight: 500;
    }

    .tax-input-group input,
    .tax-input-group select {
        width: 100%;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
        margin-bottom: 10px;
    }

    .tax-input-group input:focus,
    .tax-input-group select:focus {
        outline: none;
        border-color: #667eea;
    }

    .calculate-section {
        text-align: center;
        margin: 30px 0;
    }

    .calculate-btn {
        padding: 15px 50px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .result-section {
        display: none;
        margin-top: 30px;
        animation: fadeIn 0.5s;
    }

    .result-section.show {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .result-summary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
        text-align: center;
    }

    .result-summary h2 {
        font-size: 1.5em;
        margin-bottom: 10px;
    }

    .result-summary .total-tax {
        font-size: 2.5em;
        font-weight: bold;
        margin: 15px 0;
    }

    .monthly-schedule {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .month-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .month-card.has-tax {
        border-left: 4px solid #667eea;
    }

    .month-title {
        font-size: 1.3em;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 15px;
    }

    .tax-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        margin-bottom: 8px;
        background: #f8f9fa;
        border-radius: 6px;
    }

    .month-total {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        margin-top: 10px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 6px;
        font-weight: bold;
    }

    .detail-section {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 20px;
    }

    .detail-section h3 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.4em;
    }

    .detail-item {
        background: white;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .detail-item-header {
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        font-size: 1.1em;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .detail-row:last-child {
        border-bottom: none;
    }

    .tip-box {
        background: #fff3cd;
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid #ffc107;
    }

    .tip-box h4 {
        color: #856404;
        margin-bottom: 15px;
        font-size: 1.2em;
    }

    .tip-box ul {
        list-style-position: inside;
        color: #856404;
    }

    .tip-box li {
        margin-bottom: 8px;
    }

    @media (max-width: 768px) {
        .tax-header h1 {
            font-size: 1.5em;
        }
        .tax-content {
            padding: 20px;
        }
        .tax-grid {
            grid-template-columns: 1fr;
        }
        .monthly-schedule {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="tax-page-container">
    <div class="tax-header">
        <h1>ğŸ§® <span id="current-year">2025</span>ë…„ ì—°ê°„ ì„¸ê¸ˆ ì‹œë®¬ë ˆì´í„°</h1>
        <p>ì„¸ê¸ˆ ëŒ€ìƒì„ ì„ íƒí•˜ê³  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì—¬ ì—°ê°„ ì„¸ê¸ˆì„ ê³„ì‚°í•˜ì„¸ìš”</p>
    </div>

    <div class="tax-content">
        <div class="tax-grid">
            <!-- ì†Œë“ì„¸ -->
            <div class="tax-card" id="card-income">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-income">
                    <span class="tax-card-title">ì†Œë“ì„¸ (ì§€ë°©ì†Œë“ì„¸ í¬í•¨)</span>
                </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> ë§¤ì›” ì›ì²œì§•ìˆ˜<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> ê³¼ì„¸í‘œì¤€ Ã— ì„¸ìœ¨(6~45%) + ì§€ë°©ì†Œë“ì„¸ 10%
                </div>
                <div class="tax-input-group">
                    <label>ì—°ê°„ ê¸‰ì—¬ ì´ì•¡ (ì›)</label>
                    <input type="text" id="input-income" placeholder="ì˜ˆ: 200000000">
                </div>
            </div>

            <!-- ë¶€ê°€ê°€ì¹˜ì„¸ -->
            <div class="tax-card" id="card-vat">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-vat">
                    <span class="tax-card-title">ë¶€ê°€ê°€ì¹˜ì„¸</span>
                </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> 1ì›”, 4ì›”, 7ì›”, 10ì›”<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> ê³µê¸‰ê°€ì•¡ Ã— 10%
                </div>
                <div class="tax-input-group">
                    <label>ë¶„ê¸° ë§¤ì¶œì•¡ (ì›)</label>
                    <input type="text" id="input-vat" placeholder="ì˜ˆ: 50000000">
                </div>
            </div>

            <!-- ì¢…í•©ë¶€ë™ì‚°ì„¸ -->
            <div class="tax-card" id="card-property">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-property">
                    <span class="tax-card-title">ì¢…í•©ë¶€ë™ì‚°ì„¸</span>
                </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> 12ì›” (1~15ì¼)<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> ê³µì‹œê°€ê²© í•©ì‚° Ã— ì„¸ìœ¨(0.5~6%)
                </div>
                <div class="tax-input-group">
                    <label>ê³µì‹œê°€ê²© í•©ê³„ (ì›)</label>
                    <input type="text" id="input-property" placeholder="ì˜ˆ: 1500000000">
                </div>
            </div>

            <!-- ì¦ê¶Œê±°ë˜ì„¸ -->
            <div class="tax-card" id="card-stock">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-stock">
                    <span class="tax-card-title">ì¦ê¶Œê±°ë˜ì„¸</span>
                </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> ì£¼ì‹ ë§¤ë„ ì‹œ<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> ë§¤ë„ê¸ˆì•¡ Ã— 0.18%
                </div>
                <div class="tax-input-group">
                    <label>ì£¼ì‹ ë§¤ë„ê¸ˆì•¡ (ì›)</label>
                    <input type="text" id="input-stock" placeholder="ì˜ˆ: 100000000">
        </div>
    </div>

            <!-- ë°°ë‹¹ì†Œë“ì„¸ -->
            <div class="tax-card" id="card-dividend">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-dividend">
                    <span class="tax-card-title">ë°°ë‹¹ì†Œë“ì„¸</span>
                </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> ë°°ë‹¹ ì§€ê¸‰ ì‹œ<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> 2ì²œë§Œì› ë¯¸ë§Œ 15.4%
                </div>
                <div class="tax-input-group">
                    <label>ì—°ê°„ ë°°ë‹¹ê¸ˆ (ì›)</label>
                    <input type="text" id="input-dividend" placeholder="ì˜ˆ: 15000000">
                </div>
                                        </div>

            <!-- ì–‘ë„ì†Œë“ì„¸ -->
            <div class="tax-card" id="card-capital">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-capital">
                    <span class="tax-card-title">ì–‘ë„ì†Œë“ì„¸</span>
                                        </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> ì–‘ë„ì¼ë¡œë¶€í„° 2ê°œì›”<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> ì–‘ë„ì°¨ìµ Ã— ì„¸ìœ¨(6~75%)
                                        </div>
                <div class="tax-input-group">
                    <label>ì–‘ë„ì°¨ìµ (ì›)</label>
                    <input type="text" id="input-capital-gain" placeholder="ì˜ˆ: 50000000">
                    <label>ë³´ìœ ê¸°ê°„ (ë…„)</label>
                    <input type="text" id="input-capital-years" placeholder="ì˜ˆ: 3">
                                        </div>
                                        </div>

            <!-- ì¦ì—¬ì„¸ -->
            <div class="tax-card" id="card-gift">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-gift">
                    <span class="tax-card-title">ì¦ì—¬ì„¸</span>
                                        </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> ì¦ì—¬ì¼ë¡œë¶€í„° 3ê°œì›”<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> (ì¦ì—¬ì¬ì‚° - ê³µì œ) Ã— ì„¸ìœ¨
                                        </div>
                <div class="tax-input-group">
                    <label>ì¦ì—¬ê¸ˆì•¡ (ì›)</label>
                    <input type="text" id="input-gift" placeholder="ì˜ˆ: 100000000">
                    <label>ìˆ˜ì¦ì</label>
                    <select id="input-gift-type">
                        <option value="ë°°ìš°ì">ë°°ìš°ì (6ì–µ ê³µì œ)</option>
                        <option value="ì§ê³„ì¡´ì†">ì§ê³„ì¡´ì† (5ì²œë§Œì› ê³µì œ)</option>
                        <option value="ì§ê³„ë¹„ì†">ì§ê³„ë¹„ì† (5ì²œë§Œì› ê³µì œ)</option>
                        <option value="ê¸°íƒ€ì¹œì¡±">ê¸°íƒ€ì¹œì¡± (1ì²œë§Œì› ê³µì œ)</option>
                                        </select>
                </div>
                                        </div>

            <!-- ì·¨ë“ì„¸ -->
            <div class="tax-card" id="card-acquisition">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-acquisition">
                    <span class="tax-card-title">ì·¨ë“ì„¸</span>
                </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> ì·¨ë“ì¼ë¡œë¶€í„° 60ì¼<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> ì·¨ë“ê°€ì•¡ Ã— 1~12%
                                        </div>
                <div class="tax-input-group">
                    <label>ì·¨ë“ê°€ì•¡ (ì›)</label>
                    <input type="text" id="input-acquisition" placeholder="ì˜ˆ: 500000000">
                    <label>ìì‚° ìœ í˜•</label>
                    <select id="input-acquisition-type">
                        <option value="ì£¼íƒ">ì£¼íƒ</option>
                        <option value="í† ì§€">í† ì§€</option>
                        <option value="ê±´ë¬¼">ê±´ë¬¼</option>
                        <option value="ì°¨ëŸ‰">ì°¨ëŸ‰</option>
                    </select>
                                        </div>
                                        </div>

            <!-- ì¬ì‚°ì„¸ -->
            <div class="tax-card" id="card-realty">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-realty">
                    <span class="tax-card-title">ì¬ì‚°ì„¸</span>
                </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> 7ì›”, 9ì›”<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> ê³µì‹œê°€ê²© Ã— ì„¸ìœ¨(0.1~0.4%)
                </div>
                <div class="tax-input-group">
                    <label>ê³µì‹œê°€ê²© (ì›)</label>
                    <input type="text" id="input-realty" placeholder="ì˜ˆ: 800000000">
                    <label>ì¬ì‚° ìœ í˜•</label>
                    <select id="input-realty-type">
                        <option value="ì£¼íƒ">ì£¼íƒ</option>
                        <option value="í† ì§€">í† ì§€</option>
                    </select>
                </div>
            </div>

            <!-- ìë™ì°¨ì„¸ -->
            <div class="tax-card" id="card-car">
                <div class="tax-card-header">
                    <input type="checkbox" id="check-car">
                    <span class="tax-card-title">ìë™ì°¨ì„¸</span>
                </div>
                <div class="tax-info">
                    <strong>â° ë‚©ë¶€ì‹œê¸°:</strong> 6ì›”, 12ì›”<br>
                    <strong>ğŸ“ ê³„ì‚°ì‹:</strong> ë°°ê¸°ëŸ‰(cc) Ã— ccë‹¹ ê¸ˆì•¡
                    </div>
                <div class="tax-input-group">
                    <label>ë°°ê¸°ëŸ‰ (cc)</label>
                    <input type="text" id="input-car" placeholder="ì˜ˆ: 2000">
                    <label>ì°¨ëŸ‰ ìœ í˜•</label>
                    <select id="input-car-type">
                        <option value="ë¹„ì˜ì—…ìš©">ë¹„ì˜ì—…ìš©</option>
                        <option value="ì˜ì—…ìš©">ì˜ì—…ìš©</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="calculate-section">
            <button class="calculate-btn" onclick="calculateAllTaxes()">ğŸ’° ì—°ê°„ ì´ ì„¸ê¸ˆ ê³„ì‚°í•˜ê¸°</button>
        </div>

        <div class="result-section" id="result-section">
            <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
        </div>
    </div>
</div>

<script>
// í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ì—°ë„ ì„¤ì • ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.addEventListener('DOMContentLoaded', function() {
    // í˜„ì¬ ì—°ë„ ì„¤ì •
    document.getElementById('current-year').textContent = new Date().getFullYear();
    
    // ëª¨ë“  ì²´í¬ë°•ìŠ¤ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    var checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            var cardId = this.id.replace('check-', 'card-');
            var card = document.getElementById(cardId);
            
            if (this.checked) {
                card.classList.add('active');
            } else {
                card.classList.remove('active');
            }
        });
    });
    
    // ëª¨ë“  ìˆ«ì ì…ë ¥ë€ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    var inputs = document.querySelectorAll('input[type="text"]');
    inputs.forEach(function(input) {
        input.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    });
});

// ìˆ«ì í¬ë§·
function formatNumber(num) {
    return Math.round(num).toLocaleString('ko-KR');
}

// ì „ì²´ ê³„ì‚°
    function calculateAllTaxes() {
    var totalTax = 0;
    var taxDetails = [];
    var monthlySchedule = {};
    
    // ì›”ë³„ ì´ˆê¸°í™”
    for (var i = 1; i <= 12; i++) {
        monthlySchedule[i] = [];
    }

    // ì†Œë“ì„¸
    if (document.getElementById('check-income').checked) {
        var income = parseInt(document.getElementById('input-income').value) || 0;
        if (income > 0) {
            var result = calcIncomeTax(income);
            totalTax += result.total;
            taxDetails.push({name: 'ì†Œë“ì„¸ (ì§€ë°©ì†Œë“ì„¸ í¬í•¨)', details: result});
            for (var m = 1; m <= 12; m++) {
                monthlySchedule[m].push({name: 'ì†Œë“ì„¸', amount: result.total / 12});
            }
        }
    }

    // ë¶€ê°€ê°€ì¹˜ì„¸
    if (document.getElementById('check-vat').checked) {
        var vat = parseInt(document.getElementById('input-vat').value) || 0;
        if (vat > 0) {
            var result = calcVAT(vat);
            totalTax += result.total;
            taxDetails.push({name: 'ë¶€ê°€ê°€ì¹˜ì„¸', details: result});
            [1, 4, 7, 10].forEach(function(month) {
                monthlySchedule[month].push({name: 'ë¶€ê°€ê°€ì¹˜ì„¸', amount: result.quarterly});
            });
        }
    }

    // ì¢…í•©ë¶€ë™ì‚°ì„¸
    if (document.getElementById('check-property').checked) {
        var property = parseInt(document.getElementById('input-property').value) || 0;
        if (property > 0) {
            var result = calcPropertyTax(property);
            totalTax += result.total;
            taxDetails.push({name: 'ì¢…í•©ë¶€ë™ì‚°ì„¸', details: result});
            monthlySchedule[12].push({name: 'ì¢…í•©ë¶€ë™ì‚°ì„¸', amount: result.total});
        }
    }

    // ì¦ê¶Œê±°ë˜ì„¸
    if (document.getElementById('check-stock').checked) {
        var stock = parseInt(document.getElementById('input-stock').value) || 0;
        if (stock > 0) {
            var result = calcStockTax(stock);
            totalTax += result.total;
            taxDetails.push({name: 'ì¦ê¶Œê±°ë˜ì„¸', details: result});
        }
    }

    // ë°°ë‹¹ì†Œë“ì„¸
    if (document.getElementById('check-dividend').checked) {
        var dividend = parseInt(document.getElementById('input-dividend').value) || 0;
        if (dividend > 0) {
            var result = calcDividendTax(dividend);
            totalTax += result.total;
            taxDetails.push({name: 'ë°°ë‹¹ì†Œë“ì„¸', details: result});
        }
    }

    // ì–‘ë„ì†Œë“ì„¸
    if (document.getElementById('check-capital').checked) {
        var gain = parseInt(document.getElementById('input-capital-gain').value) || 0;
        var years = parseInt(document.getElementById('input-capital-years').value) || 0;
        if (gain > 0 && years > 0) {
            var result = calcCapitalGainsTax(gain, years);
            totalTax += result.total;
            taxDetails.push({name: 'ì–‘ë„ì†Œë“ì„¸', details: result});
        }
    }

    // ì¦ì—¬ì„¸
    if (document.getElementById('check-gift').checked) {
        var gift = parseInt(document.getElementById('input-gift').value) || 0;
        var giftType = document.getElementById('input-gift-type').value;
        if (gift > 0) {
            var result = calcGiftTax(gift, giftType);
            totalTax += result.total;
            taxDetails.push({name: 'ì¦ì—¬ì„¸', details: result});
        }
    }

    // ì·¨ë“ì„¸
    if (document.getElementById('check-acquisition').checked) {
        var acquisition = parseInt(document.getElementById('input-acquisition').value) || 0;
        var acquisitionType = document.getElementById('input-acquisition-type').value;
        if (acquisition > 0) {
            var result = calcAcquisitionTax(acquisition, acquisitionType);
            totalTax += result.total;
            taxDetails.push({name: 'ì·¨ë“ì„¸', details: result});
        }
    }

    // ì¬ì‚°ì„¸
    if (document.getElementById('check-realty').checked) {
        var realty = parseInt(document.getElementById('input-realty').value) || 0;
        var realtyType = document.getElementById('input-realty-type').value;
        if (realty > 0) {
            var result = calcRealtyTax(realty, realtyType);
            totalTax += result.total;
            taxDetails.push({name: 'ì¬ì‚°ì„¸', details: result});
            monthlySchedule[7].push({name: 'ì¬ì‚°ì„¸', amount: result.total / 2});
            monthlySchedule[9].push({name: 'ì¬ì‚°ì„¸', amount: result.total / 2});
        }
    }

    // ìë™ì°¨ì„¸
    if (document.getElementById('check-car').checked) {
        var car = parseInt(document.getElementById('input-car').value) || 0;
        var carType = document.getElementById('input-car-type').value;
        if (car > 0) {
            var result = calcCarTax(car, carType);
            totalTax += result.total;
            taxDetails.push({name: 'ìë™ì°¨ì„¸', details: result});
            monthlySchedule[6].push({name: 'ìë™ì°¨ì„¸', amount: result.total / 2});
            monthlySchedule[12].push({name: 'ìë™ì°¨ì„¸', amount: result.total / 2});
        }
    }

    if (taxDetails.length === 0) {
        alert('ìµœì†Œ í•œ ê°œ ì´ìƒì˜ ì„¸ê¸ˆì„ ì„ íƒí•˜ê³  ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    showResults(totalTax, taxDetails, monthlySchedule);
}

// ê²°ê³¼ í‘œì‹œ
function showResults(totalTax, taxDetails, monthlySchedule) {
    var currentYear = new Date().getFullYear();
    var html = '<div class="result-summary">';
    html += '<h2>ğŸ“Š ' + currentYear + 'ë…„ ì—°ê°„ ì„¸ê¸ˆ ì´ì•¡</h2>';
    html += '<div class="total-tax">' + formatNumber(totalTax) + 'ì›</div>';
    html += '</div>';

    html += '<h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.5em;">ğŸ“… ì›”ë³„ ë‚©ë¶€ ì¼ì •</h3>';
    html += '<div class="monthly-schedule">';

    for (var month = 1; month <= 12; month++) {
        var hasTax = monthlySchedule[month].length > 0;
        var monthTotal = 0;
        
        monthlySchedule[month].forEach(function(item) {
            monthTotal += item.amount;
        });

        html += '<div class="month-card ' + (hasTax ? 'has-tax' : '') + '">';
        html += '<div class="month-title">' + month + 'ì›”</div>';

        if (hasTax) {
            monthlySchedule[month].forEach(function(item) {
                html += '<div class="tax-item">';
                html += '<span>' + item.name + '</span>';
                html += '<span>' + formatNumber(item.amount) + 'ì›</span>';
                html += '</div>';
            });
            html += '<div class="month-total">';
            html += '<span>í•©ê³„</span>';
            html += '<span>' + formatNumber(monthTotal) + 'ì›</span>';
            html += '</div>';
        } else {
            html += '<div style="color: #999; text-align: center; padding: 20px 0;">ë‚©ë¶€ ì„¸ê¸ˆ ì—†ìŒ</div>';
        }

        html += '</div>';
    }

    html += '</div>';

    // ìƒì„¸ ë‚´ì—­
    html += '<div class="detail-section">';
    html += '<h3>ğŸ“‹ ì„¸ëª©ë³„ ìƒì„¸ ë‚´ì—­</h3>';

    taxDetails.forEach(function(tax) {
        html += '<div class="detail-item">';
        html += '<div class="detail-item-header">' + tax.name + '</div>';
        
        for (var key in tax.details) {
            if (key !== 'total' && key !== 'quarterly') {
                html += '<div class="detail-row">';
                html += '<span>' + key + '</span>';
                html += '<span>' + (typeof tax.details[key] === 'number' ? formatNumber(tax.details[key]) + 'ì›' : tax.details[key]) + '</span>';
                html += '</div>';
            }
        }
        
        html += '<div class="detail-row" style="border-top: 2px solid #667eea; padding-top: 10px; margin-top: 10px;">';
        html += '<span style="color: #667eea; font-weight: bold;">ì´ ì„¸ì•¡</span>';
        html += '<span style="color: #667eea; font-size: 1.1em; font-weight: bold;">' + formatNumber(tax.details.total) + 'ì›</span>';
        html += '</div>';
        
        html += '</div>';
    });

    html += '</div>';

    // ì ˆì„¸ íŒ
    html += '<div class="tip-box">';
    html += '<h4>ğŸ’¡ ì„¸ê¸ˆ ì ˆì•½ TIP</h4>';
    html += '<ul>';
    html += '<li><strong>ì—°ê¸ˆì €ì¶•:</strong> ì—° 700ë§Œì›ê¹Œì§€ ì„¸ì•¡ê³µì œ (ìµœëŒ€ 115ë§Œì› ì ˆì„¸)</li>';
    html += '<li><strong>ì£¼íƒì²­ì•½:</strong> ì—° 240ë§Œì›ê¹Œì§€ ì„¸ì•¡ê³µì œ (ìµœëŒ€ 39ë§Œì› ì ˆì„¸)</li>';
    html += '<li><strong>ì‹ ìš©ì¹´ë“œ:</strong> ì´ê¸‰ì—¬ 25% ì´ˆê³¼ë¶„ 15~40% ê³µì œ</li>';
    html += '<li><strong>ì˜ë£Œë¹„:</strong> ì´ê¸‰ì—¬ 3% ì´ˆê³¼ë¶„ 15% ì„¸ì•¡ê³µì œ</li>';
    html += '<li><strong>êµìœ¡ë¹„:</strong> 1ì¸ë‹¹ ì—° 900ë§Œì›ê¹Œì§€ 15% ì„¸ì•¡ê³µì œ</li>';
    html += '</ul>';
    html += '</div>';

    document.getElementById('result-section').innerHTML = html;
    document.getElementById('result-section').classList.add('show');
    document.getElementById('result-section').scrollIntoView({behavior: 'smooth', block: 'nearest'});
}

// ì†Œë“ì„¸ ê³„ì‚°
function calcIncomeTax(amount) {
    var deduction;
    if (amount <= 5000000) deduction = amount * 0.7;
    else if (amount <= 15000000) deduction = 3500000 + (amount - 5000000) * 0.4;
    else if (amount <= 45000000) deduction = 7500000 + (amount - 15000000) * 0.15;
    else if (amount <= 100000000) deduction = 12000000 + (amount - 45000000) * 0.05;
    else deduction = 14750000 + (amount - 100000000) * 0.02;

    var taxableIncome = Math.max(0, amount - deduction - 1500000);
    var tax = 0;

    if (taxableIncome <= 14000000) tax = taxableIncome * 0.06;
    else if (taxableIncome <= 50000000) tax = 840000 + (taxableIncome - 14000000) * 0.15;
    else if (taxableIncome <= 88000000) tax = 6240000 + (taxableIncome - 50000000) * 0.24;
    else if (taxableIncome <= 150000000) tax = 15360000 + (taxableIncome - 88000000) * 0.35;
    else if (taxableIncome <= 300000000) tax = 37060000 + (taxableIncome - 150000000) * 0.38;
    else if (taxableIncome <= 500000000) tax = 94060000 + (taxableIncome - 300000000) * 0.40;
    else if (taxableIncome <= 1000000000) tax = 174060000 + (taxableIncome - 500000000) * 0.42;
    else tax = 384060000 + (taxableIncome - 1000000000) * 0.45;

    var localTax = tax * 0.1;
    return {'ì—°ê°„ ê¸‰ì—¬': amount, 'ê·¼ë¡œì†Œë“ê³µì œ': deduction, 'ê³¼ì„¸í‘œì¤€': taxableIncome, 'ì†Œë“ì„¸': tax, 'ì§€ë°©ì†Œë“ì„¸': localTax, total: tax + localTax};
}

// ë¶€ê°€ê°€ì¹˜ì„¸ ê³„ì‚°
function calcVAT(amount) {
    var vat = amount * 0.1;
    return {'ë¶„ê¸° ë§¤ì¶œì•¡': amount, 'ë¶„ê¸° ë¶€ê°€ì„¸': vat, quarterly: vat, total: vat * 4};
}

// ì¢…í•©ë¶€ë™ì‚°ì„¸ ê³„ì‚°
function calcPropertyTax(amount) {
    var tax = 0;
    if (amount > 1200000000) {
        if (amount <= 6000000000) tax = (amount - 1200000000) * 0.005;
        else tax = (6000000000 - 1200000000) * 0.005 + (amount - 6000000000) * 0.06;
    }
    return {'ê³µì‹œê°€ê²© í•©ì‚°': amount, 'ê³¼ì„¸ ì—¬ë¶€': amount <= 1200000000 ? 'ë¹„ê³¼ì„¸' : 'ê³¼ì„¸', total: tax};
}

// ì¦ê¶Œê±°ë˜ì„¸ ê³„ì‚°
function calcStockTax(amount) {
    var tax = amount * 0.0018;
    return {'ë§¤ë„ê¸ˆì•¡': amount, 'ì‹¤ìˆ˜ë ¹ì•¡': amount - tax, total: tax};
}

// ë°°ë‹¹ì†Œë“ì„¸ ê³„ì‚°
function calcDividendTax(amount) {
    var isSeparate = amount < 20000000;
    var tax = amount * 0.14;
    var localTax = isSeparate ? amount * 0.014 : tax * 0.1;
    return {'ë°°ë‹¹ê¸ˆ': amount, 'ê³¼ì„¸ë°©ì‹': isSeparate ? 'ë¶„ë¦¬ê³¼ì„¸' : 'ì¢…í•©ê³¼ì„¸', 'ë°°ë‹¹ì†Œë“ì„¸': tax, 'ì§€ë°©ì†Œë“ì„¸': localTax, total: tax + localTax};
}

// ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°
function calcCapitalGainsTax(gain, years) {
    var taxableGain = Math.max(0, gain - 2500000);
    var longTermRate = years >= 3 ? Math.min(0.3, (years - 2) * 0.08) : 0;
    taxableGain = taxableGain * (1 - longTermRate);

    var tax = 0;
    if (taxableGain <= 14000000) tax = taxableGain * 0.06;
    else if (taxableGain <= 50000000) tax = 840000 + (taxableGain - 14000000) * 0.15;
    else if (taxableGain <= 88000000) tax = 6240000 + (taxableGain - 50000000) * 0.24;
    else if (taxableGain <= 150000000) tax = 15360000 + (taxableGain - 88000000) * 0.35;
    else if (taxableGain <= 300000000) tax = 37060000 + (taxableGain - 150000000) * 0.38;
    else if (taxableGain <= 500000000) tax = 94060000 + (taxableGain - 300000000) * 0.40;
    else tax = 174060000 + (taxableGain - 500000000) * 0.42;

    var localTax = tax * 0.1;
    return {'ì–‘ë„ì°¨ìµ': gain, 'ë³´ìœ ê¸°ê°„': years + 'ë…„', 'ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ': (longTermRate * 100).toFixed(0) + '%', 'ê³¼ì„¸í‘œì¤€': taxableGain, 'ì–‘ë„ì†Œë“ì„¸': tax, 'ì§€ë°©ì†Œë“ì„¸': localTax, total: tax + localTax};
}

// ì¦ì—¬ì„¸ ê³„ì‚°
function calcGiftTax(amount, recipientType) {
    var deductions = {'ë°°ìš°ì': 600000000, 'ì§ê³„ì¡´ì†': 50000000, 'ì§ê³„ë¹„ì†': 50000000, 'ê¸°íƒ€ì¹œì¡±': 10000000};
    var deduction = deductions[recipientType];
    var taxableAmount = Math.max(0, amount - deduction);

    var tax = 0;
    if (taxableAmount <= 100000000) tax = taxableAmount * 0.1;
    else if (taxableAmount <= 500000000) tax = 10000000 + (taxableAmount - 100000000) * 0.2;
    else if (taxableAmount <= 1000000000) tax = 90000000 + (taxableAmount - 500000000) * 0.3;
    else if (taxableAmount <= 3000000000) tax = 240000000 + (taxableAmount - 1000000000) * 0.4;
    else tax = 1040000000 + (taxableAmount - 3000000000) * 0.5;

    return {'ì¦ì—¬ê¸ˆì•¡': amount, 'ìˆ˜ì¦ì': recipientType, 'ì¦ì—¬ê³µì œ': deduction, 'ê³¼ì„¸í‘œì¤€': taxableAmount, total: tax};
    }

    // ì·¨ë“ì„¸ ê³„ì‚°
function calcAcquisitionTax(amount, propertyType) {
    var baseRate = 0.04;
    if (propertyType === 'ì£¼íƒ') {
        if (amount <= 600000000) baseRate = 0.01;
        else if (amount <= 900000000) baseRate = 0.023;
        else baseRate = 0.03;
    } else if (propertyType === 'ì°¨ëŸ‰') baseRate = 0.07;

    var acquisitionTax = amount * baseRate;
    var educationTax = acquisitionTax * 0.1;
    var agricultureTax = (propertyType === 'ì£¼íƒ' || propertyType === 'í† ì§€' || propertyType === 'ê±´ë¬¼') ? acquisitionTax * 0.2 : 0;

    return {'ì·¨ë“ê°€ì•¡': amount, 'ìì‚°ìœ í˜•': propertyType, 'ì·¨ë“ì„¸': acquisitionTax, 'ì§€ë°©êµìœ¡ì„¸': educationTax, 'ë†íŠ¹ì„¸': agricultureTax, total: acquisitionTax + educationTax + agricultureTax};
    }

    // ì¬ì‚°ì„¸ ê³„ì‚°
function calcRealtyTax(amount, propertyType) {
    var taxRate = 0.0025;
    if (propertyType === 'ì£¼íƒ') {
        if (amount <= 60000000) taxRate = 0.001;
        else if (amount <= 150000000) taxRate = 0.0015;
        else if (amount <= 300000000) taxRate = 0.0025;
        else taxRate = 0.004;
    } else taxRate = 0.002;

    var propertyTax = amount * taxRate;
    var educationTax = propertyTax * 0.2;

    return {'ê³µì‹œê°€ê²©': amount, 'ì¬ì‚°ìœ í˜•': propertyType, 'ì¬ì‚°ì„¸': propertyTax, 'ì§€ë°©êµìœ¡ì„¸': educationTax, total: propertyTax + educationTax};
    }

    // ìë™ì°¨ì„¸ ê³„ì‚°
function calcCarTax(cc, carType) {
    var rate;
    if (carType === 'ë¹„ì˜ì—…ìš©') {
        if (cc <= 1000) rate = 80;
        else if (cc <= 1600) rate = 140;
        else rate = 200;
    } else {
        if (cc <= 1000) rate = 18;
        else if (cc <= 1600) rate = 19;
        else rate = 24;
    }

    var annualTax = cc * rate;
    var educationTax = annualTax * 0.3;

    return {'ë°°ê¸°ëŸ‰': cc + 'cc', 'ì°¨ëŸ‰ìœ í˜•': carType, 'ccë‹¹ ì„¸ì•¡': rate + 'ì›', 'ìë™ì°¨ì„¸': annualTax, 'êµìœ¡ì„¸': educationTax, total: annualTax + educationTax};
    }
</script>
{% endblock %}
